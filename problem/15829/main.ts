import { flow } from "fp/function.ts"
import { simplify, print } from "util/simplify.ts"

import { split } from "fp/string.ts"
import { mapWithIndex, reduce } from "fp/ReadonlyNonEmptyArray.ts"

const ri = [1, 31, 961, 29791, 923521, 28629151, 887503681, 352120509, 1039192651, 116207015, 1133281683, 563831225, 194817501, 1101070967, 799866920, 104516700, 770881918, 440549529, 76788598, 1145878647, 954337109, 1189388886, 1068586627, 1027420271, 985831126, 931135522, 470139689, 994083558, 1186960914, 993319495, 1163274961, 259054952, 623296166, 803662781, 222188391, 715000666, 1177366499, 695892630, 585017383, 851588399, 473314658, 1092507597, 534402450, 517093367, 1215079685, 630433505, 1024920290, 908331715, 997789563, 67279178, 851086627] // [1, ...Array(50).fill(0).map((x, i, l) => l[i]=(l[i-1]||1)*31%1234567891)]

// https://developer-mac.tistory.com/84

export const main = flow(
    simplify,
    ([_, [s]]) => s,
    split(""),
    mapWithIndex((i, c) => 
        (c.charCodeAt(0)-96)*ri[i]%1234567891
    ),
    reduce(0, (p, c) => p + c),
    n => n%1234567891
)